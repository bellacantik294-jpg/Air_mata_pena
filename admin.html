<!doctype html>
<html lang="id">
<head>
  <meta<link rel="stylesheet" href="style.css">
 charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin - Air Mata Pena</title>
  <style>
    body { font-family: Arial; padding:20px; background:#111; color:#fff; }
    input, textarea { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #444; background:#222; color:#fff; }
    button { padding:10px 20px; margin-top:10px; background:#ff0080; border:none; color:white; border-radius:8px; }
    .card { background:#222; padding:10px; margin:10px 0; border-radius:8px; }
    .del { background:#ff3333; }
  </style>
</head>

<body>
  <main class="container">
    <h2>Admin Sederhana</h2>

    <section class="admin-login">
      <input id="admin-email" placeholder="Email admin" />
      <input id="admin-pass" type="password" placeholder="Password" />
      <button id="btn-login">Login</button>
      <button id="btn-logout" style="display:none">Logout</button>
    </section>

    <section id="admin-area" style="display:none">
      <h3>Buat Cerpen Baru</h3>
      <input id="title" placeholder="Judul" />
      <textarea id="body" placeholder="Isi cerpen"></textarea>
      <button id="create">Buat</button>

      <h3>Daftar Cerpen</h3>
      <div id="list-cerpen"></div>
    </section>
  </main>

  <!-- WAJIB: firebase-config.js harus module -->
  <script type="module" src="firebase-config.js"></script>

  <!-- WAJIB: kode admin juga module -->
  <script type="module">
    import {
      adminSignIn,
      adminSignOut,
      createCerpen,
      listCerpen,
      deleteCerpen
    } from "./firebase-user.js";

    document.getElementById('btn-login').addEventListener('click', async ()=>{
      const email = document.getElementById('admin-email').value;
      const pass = document.getElementById('admin-pass').value;

      try {
        await adminSignIn(email, pass);
        alert("Login sukses!");

        document.getElementById('admin-area').style.display = '';
        document.getElementById('btn-logout').style.display = '';
        document.getElementById('btn-login').style.display = 'none';

        loadList();
      }
      catch(e) {
        alert("Login gagal: " + e.message);
      }
    });

    document.getElementById('btn-logout').addEventListener('click', async ()=>{
      await adminSignOut();
      location.reload();
    });

    document.getElementById('create').addEventListener('click', async ()=>{
      const title = document.getElementById('title').value;
      const body  = document.getElementById('body').value;

      if (!title || !body) return alert("Judul & isi tidak boleh kosong");

      await createCerpen({ title, body });

      alert("Cerpen dibuat!");
      document.getElementById('title').value = '';
      document.getElementById('body').value  = '';

      loadList();
    });

    async function loadList(){
      const node = document.getElementById('list-cerpen');
      node.innerHTML = "Memuat...";

      const items = await listCerpen(100);
      node.innerHTML = "";

      items.forEach(it=>{
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <h4>${it.title}</h4>
          <button class="del" data-id="${it.id}">Hapus</button>
        `;
        node.appendChild(div);
      });

      document.querySelectorAll('.del').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          if (!confirm("Hapus cerpen ini?")) return;
          await deleteCerpen(btn.dataset.id);
          loadList();
        });
      });
    }
  </script>

</body>
</html>
