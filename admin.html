<!doctype html>
<html lang="id">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Admin - Air Mata Pena</title><link rel="stylesheet" href="style_dark.css" /></head>
<body>
  <main class="container">
    <h2>Admin Sederhana</h2>
    <section class="admin-login">
      <input id="admin-email" placeholder="Email admin" />
      <input id="admin-pass" type="password" placeholder="Password" />
      <button id="btn-login">Login</button>
      <button id="btn-logout" style="display:none">Logout</button>
    </section>

    <section id="admin-area" style="display:none">
      <h3>Buat Cerpen Baru</h3>
      <input id="title" placeholder="Judul" />
      <textarea id="body" placeholder="Isi cerpen"></textarea>
      <button id="create">Buat</button>

      <h3>Daftar Cerpen</h3>
      <div id="list-cerpen"></div>
    </section>
  </main>

  <script src="firebase-config.js"></script>
  <script type="module">
    import { adminSignIn, adminSignOut, createCerpen, listCerpen, deleteCerpen } from './firebase-user.js';
    document.getElementById('btn-login').addEventListener('click', async ()=>{
      const email = document.getElementById('admin-email').value;
      const pass = document.getElementById('admin-pass').value;
      try{ await adminSignIn(email,pass); alert('Login sukses'); document.getElementById('admin-area').style.display=''; document.getElementById('btn-logout').style.display=''; document.getElementById('btn-login').style.display='none'; loadList(); }catch(e){ alert('Gagal: '+e.message); }
    });
    document.getElementById('btn-logout').addEventListener('click', async ()=>{ await adminSignOut(); location.reload(); });
    document.getElementById('create').addEventListener('click', async ()=>{
      const t = document.getElementById('title').value; const b = document.getElementById('body').value;
      if(!t||!b) return alert('Isi judul & isi');
      await createCerpen({title:t, body:b});
      alert('Cerpen dibuat'); document.getElementById('title').value=''; document.getElementById('body').value=''; loadList();
    });
    async function loadList(){ const node = document.getElementById('list-cerpen'); node.innerHTML='Memuat...'; const items = await listCerpen(100); node.innerHTML=''; items.forEach(it=>{ const div=document.createElement('div'); div.className='card'; div.innerHTML = '<h4>'+it.title+'</h4><div><button class="del" data-id="'+it.id+'">Hapus</button></div>'; node.appendChild(div); }); document.querySelectorAll('.del').forEach(b=>b.addEventListener('click', async ()=>{ if(!confirm('Hapus?')) return; await deleteCerpen(b.dataset.id); loadList(); })); }
  </script>
</body>
</html>
